<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-8">

    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-8 border-b-2 border-blue-500 pb-2">Управление Проектами (Assignment 3)</h1>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            
            <div class="md:col-span-1">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold mb-4 text-gray-700">Новый Проект</h2>
                    <form id="projectForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-600">Название</label>
                            <input type="text" id="title" required class="w-full mt-1 p-2 border rounded-md focus:ring-2 focus:ring-blue-400 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-600">Описание</label>
                            <textarea id="description" required class="w-full mt-1 p-2 border rounded-md focus:ring-2 focus:ring-blue-400 outline-none"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-600">Бюджет ($)</label>
                            <input type="number" id="budget" required class="w-full mt-1 p-2 border rounded-md focus:ring-2 focus:ring-blue-400 outline-none">
                        </div>
                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition duration-200">
                            Создать
                        </button>
                    </form>
                </div>
            </div>

            <div class="md:col-span-2">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-semibold mb-4 text-gray-700">Все Проекты</h2>
                    <div id="projectsList" class="space-y-4">
                        <p class="text-gray-500 italic">Загрузка данных...</p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000/projects';

        async function fetchProjects() {
            try {
                const response = await fetch(API_URL);
                const projects = await response.json();
                renderProjects(projects);
            } catch (err) {
                console.error("Ошибка при получении данных:", err);
            }
        }

        function renderProjects(projects) {
            const list = document.getElementById('projectsList');
            if (projects.length === 0) {
                list.innerHTML = '<p class="text-gray-400 text-center py-4">Проектов пока нет</p>';
                return;
            }

            list.innerHTML = projects.map(p => `
                <div class="border-l-4 border-blue-500 bg-gray-50 p-4 rounded-r-md shadow-sm flex justify-between items-center">
                    <div>
                        <h3 class="font-bold text-lg text-gray-800">${p.title}</h3>
                        <p class="text-gray-600 text-sm">${p.description}</p>
                        <span class="inline-block mt-2 text-xs font-semibold px-2 py-1 bg-green-100 text-green-700 rounded">
                            Бюджет: $${p.budget}
                        </span>
                    </div>
                    <button onclick="deleteProject('${p._id}')" class="text-red-500 hover:text-red-700 font-medium text-sm transition">
                        Удалить
                    </button>
                </div>
            `).join('');
        }

        document.getElementById('projectForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const data = {
                title: document.getElementById('title').value,
                description: document.getElementById('description').value,
                budget: document.getElementById('budget').value
            };

            try {
                await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                e.target.reset(); 
                fetchProjects();  
            } catch (err) {
                alert("Ошибка при сохранении");
            }
        });

        async function deleteProject(id) {
            if (confirm('Удалить этот проект?')) {
                await fetch(`${API_URL}/\${id}`, { method: 'DELETE' });
                fetchProjects();
            }
        }

        fetchProjects();
    </script>
</body>
</html>